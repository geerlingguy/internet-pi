---
- name: Set metrics for Grafana dashboard
  delegate_to: localhost
  ansible.builtin.replace:
    path: "{{ lookup('env', 'PWD') }}/templates/airgradient-air-quality.json.j2"
    regexp: '"unit": "fahrenheit"|"unit": "celsius"'
    replace: '"unit": "{{ airgradient_metrics }}"'

- name: Copy airgradient dashboard configs to Grafana.
  ansible.builtin.template:
    src: templates/airgradient-air-quality.json.j2
    dest: "{{ config_dir }}/internet-monitoring/grafana/provisioning/dashboards/airgradient-{{ item.id }}.json"
    mode: 0644
  become: false
  loop: "{{ airgradient_sensors }}"
  notify: Restart internet-monitoring
